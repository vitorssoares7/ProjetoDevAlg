#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <iup.h>

Ihandle *dlgPR, *labelPR1, *labelPR2, *labelPR3, *labelPR4, *labelPR5, *labelPR6, *vboxPR, *hboxPR, *buttonPR1, *buttonPR2, *buttonPR3, *cxtextPR1, *cxtextPR2, *cxtextPR3, *cxtextPR4, *cxtextPR5, *cxtextPR6;
Ihandle *dlgMenu, *buttonMenu1, *buttonMenu2, *buttonMenu3, *buttonMenu4, *labelMenu, *vboxMenu;
Ihandle *labelR121, *labelR122, *labelR123, *cxtextR121, *cxtextR122, *cxtextR123, *buttonR121, *buttonR122, *vboxR12, *hboxR121, *hboxR122, *dlgR12;

struct registro{
    char categoria[20];
    float valor;
    char descricao[100];
};


struct registro dados;
	

struct Relatorio12m{
	
	char categoria[20];
    float valor;
    char descricao[100];
    int dia;
    int mes;
    int ano;
};


struct Relatorio12m dado;


struct data{
    int dia;
    int mes;
    int ano;
};


struct data d;

int registraGasto(Ihandle *self){
	int main();
	struct registro dados;
	struct data d;
	
	char *cat = IupGetAttribute(cxtextPR1, "VALUE");
	char *valo = IupGetAttribute(cxtextPR2, "VALUE");
	char *desc = IupGetAttribute(cxtextPR3, "VALUE");
	char *da = IupGetAttribute(cxtextPR4, "VALUE");
	char *mt = IupGetAttribute(cxtextPR5, "VALUE");
	char *yr = IupGetAttribute(cxtextPR6, "VALUE");
	
	float valp = atof(valo);
	int day = atoi(da);
	int mth = atoi(mt);
	int yar = atoi(yr);
	
	float valn = valp*-1;
	
	strcpy(dados.categoria, cat);
	dados.valor = valn;
	strcpy(dados.descricao, desc);
	d.dia = day;
	d.mes = mth;
	d.ano = yar;
	FILE *carteira = fopen("minhaCarteiraEletrônica.txt","a");
	fprintf(carteira,"%s\t%f\t%s\t%d\t%d\t%d\n",dados.categoria, dados.valor, dados.descricao, d.dia, d.mes, d.ano);
	fclose(carteira);
	IupMessage("Carteira Eletrônica", "Gasto registrado com sucesso");
	main();
}

int registraReceita(Ihandle *self){
	int main();
	struct registro dados;
	struct data d;
	
	char *cat = IupGetAttribute(cxtextPR1, "VALUE");
	char *valo = IupGetAttribute(cxtextPR2, "VALUE");
	char *desc = IupGetAttribute(cxtextPR3, "VALUE");
	char *da = IupGetAttribute(cxtextPR4, "VALUE");
	char *mt = IupGetAttribute(cxtextPR5, "VALUE");
	char *yr = IupGetAttribute(cxtextPR6, "VALUE");
	
	float val = atof(valo);
	int day = atoi(da);
	int mth = atoi(mt);
	int yar = atoi(yr);
	
	strcpy(dados.categoria, cat);
	dados.valor = val;
	strcpy(dados.descricao, desc);
	d.dia = day;
	d.mes = mth;
	d.ano = yar;
	FILE *carteira = fopen("minhaCarteiraEletrônica.txt","a");
	fprintf(carteira,"%s\t%f\t%s\t%d\t%d\t%d\n",dados.categoria, dados.valor, dados.descricao, d.dia, d.mes, d.ano);
	fclose(carteira);
	IupMessage("Carteira Eletrônica", "Receita registrada com sucesso");
	main();
}

int paginaRegistro( Ihandle *self ){
	IupDestroy(dlgMenu);	
	int main ();
	labelPR1 =  IupLabel("Insira a categoria :");
	labelPR2 =  IupLabel("Adicione o valor :");
	labelPR3 =  IupLabel("Insira uma descrição :");
	labelPR4 =  IupLabel("Insira o dia :");
	labelPR5 =  IupLabel("Insira o mes :");
	labelPR6 =  IupLabel("Insira o ano :");
	buttonPR1 = IupButton("Voltar a página ", NULL);
	buttonPR2 = IupButton("Registrar receita", NULL);
	buttonPR3 = IupButton("Registrar gasto", NULL);
	cxtextPR1 = IupText(NULL);
	cxtextPR2 = IupText(NULL);
	cxtextPR3 = IupText(NULL);
	cxtextPR4 = IupText(NULL);
	cxtextPR5 = IupText(NULL);
	cxtextPR6 = IupText(NULL);
	hboxPR = IupHbox(
	buttonPR2,
	buttonPR3,
    buttonPR1,
	NULL);
	vboxPR = IupVbox(
    labelPR1,
    cxtextPR1,
    labelPR2,
    cxtextPR2,
    labelPR3,
    cxtextPR3,
    labelPR4,
    cxtextPR4,
    labelPR5,
    cxtextPR5,
    labelPR6,
    cxtextPR6,
    hboxPR,
    NULL);
  	IupSetAttribute(vboxPR, "ALIGNMENT", "ACENTER");
  	IupSetAttribute(vboxPR, "GAP", "20");
  	IupSetAttribute(vboxPR, "MARGIN", "120x80");
  	IupSetAttribute(hboxPR, "ALIGNMENT", "ACENTER");
  	IupSetAttribute(hboxPR, "GAP", "20");
  	IupSetAttribute(hboxPR, "MARGIN", "20x20");
  	dlgPR = IupDialog(vboxPR);
  	IupSetAttribute(dlgPR, "TITLE", "Carteira eletrônica");
  	
  	IupSetCallback(buttonPR1, "ACTION", (Icallback) main);
  	IupSetCallback(buttonPR2, "ACTION", (Icallback) registraReceita);
  	IupSetCallback(buttonPR3, "ACTION", (Icallback) registraGasto);
  	
  	
	IupShowXY(dlgPR, IUP_CENTER, IUP_CENTER);

  	IupMainLoop();
}


int pagina12r(Ihandle *self){
	IupDestroy(dlgMenu);	
	int main ();
	labelR121 =  IupLabel("Insira o dia :");
	labelR122 =  IupLabel("Insira o mes :");
	labelR123 =  IupLabel("Insira o ano :");
	buttonR121 = IupButton("Puxar Relatório", NULL);
	buttonR122 = IupButton("Voltar ao Menu", NULL);
	cxtextR121 = IupText(NULL);
	cxtextR122 = IupText(NULL);
	cxtextR123 = IupText(NULL);
	hboxR121 = IupHbox(
	labelR121,
	labelR122,
	labelR123,
	NULL);
	hboxR122 = IupHbox(
	cxtextR121,
	cxtextR122,
	cxtextR123,
	NULL);
	vboxR12 = IupVbox(
	hboxR121,
	hboxR122,
	buttonR121,
	buttonR122,
	NULL);
	IupSetAttribute(vboxR12, "ALIGNMENT", "ACENTER");
  	IupSetAttribute(vboxR12, "GAP", "20");
  	IupSetAttribute(vboxR12, "MARGIN", "120x80");
  	IupSetAttribute(hboxR121, "ALIGNMENT", "ACENTER");
  	IupSetAttribute(hboxR121, "GAP", "20");
  	IupSetAttribute(hboxR121, "MARGIN", "20x20");
  	IupSetAttribute(hboxR122, "ALIGNMENT", "ACENTER");
  	IupSetAttribute(hboxR122, "GAP", "20");
  	IupSetAttribute(hboxR122, "MARGIN", "20x20");
  	dlgR12 = IupDialog(vboxR12);
  	IupSetAttribute(dlgR12, "TITLE", "Carteira eletrônica");
  	IupSetCallback(buttonR121, "ACTION", (Icallback) Registro12);
  	IupSetCallback(buttonR122, "ACTION", (Icallback) main);
  	
  	IupShowXY(dlgR12, IUP_CENTER, IUP_CENTER);

  	IupMainLoop();
}


int main(int argc, char **argv){

  IupOpen(&argc, &argv);
  IupDestroy(dlgPR);
  IupDestroy(dlgR12);
  IupDestroy(dlgRC);
  
  labelMenu =  IupLabel("Bem vindo a sua carteira eletronica !");
  buttonMenu1 = IupButton("Fechar carteira", NULL);
  buttonMenu2 = IupButton("Adicionar Registro a carteira", NULL);
  buttonMenu3 = IupButton("Relatório dos últimos 12 meses", NULL);
  buttonMenu4 = IupButton("Relatório por categoria", NULL);
  vboxMenu = IupVbox(
    labelMenu,
    buttonMenu2,
    buttonMenu3,
    buttonMenu4,
    buttonMenu1,
    NULL);
  IupSetAttribute(vboxMenu, "ALIGNMENT", "ACENTER");
  IupSetAttribute(vboxMenu, "GAP", "20");
  IupSetAttribute(vboxMenu, "MARGIN", "100x100");
  
  dlgMenu = IupDialog(vboxMenu);
  IupSetAttribute(dlgMenu, "TITLE", "Eletronic wallet");

  /* Registers callbacks */
  IupSetCallback(buttonMenu1, "ACTION", (Icallback) encerraPrograma);
  IupSetCallback(buttonMenu2, "ACTION", (Icallback) paginaRegistro);
  IupSetCallback(buttonMenu3, "ACTION", (Icallback) pagina12r);
  IupSetCallback(buttonMenu4, "ACTION", (Icallback) paginaRC);

  IupShowXY(dlgMenu, IUP_CENTER, IUP_CENTER);

  IupMainLoop();
}
